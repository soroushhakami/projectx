$(document).ready(function(){StartPage.render(),moment().format()});var Notification=function(){var e,n="http://i.imgur.com/i56rnqe.png",t=function(){e=window.webkitNotifications.createNotification(n,"Pomodoro done","Now take a break."),e.show()},i=function(){e=window.webkitNotifications.createNotification(n,"Break done","Now get back to work."),e.show()},s=function(){window.webkitNotifications&&window.webkitNotifications.requestPermission(function(){console.log(0===window.webkitNotifications.checkPermission()?"Has permissions for notifications ":"Didnt get permissions for notifications")})},a=function(){e&&e.close()};return{showPomodoroDone:t,showBreakDone:i,askForPermissions:s,closeNotification:a}}(),Pair=function(){var e=new LacesModel;e.users=new LacesArray,e.users.bind("change",function(){Pair.isFullPair()?$("#startBtn").removeAttr("disabled"):$("#startBtn").attr("disabled","disabled")});var n=function(n){var t=Users.getUser(n);e.users.push(t)},t=function(n){$.each(e.users,function(t,i){return i.name==n?(e.users.remove(t),!1):void 0})},i=function(){return 2==e.users.length},s=function(n){var t=!1;return $.each(e.users,function(e,i){i.name==n&&(t=!0)}),t},a=function(){return e.users},r=function(){e.users.pop(),e.users.pop()};return{addUser:n,removeUser:t,emptyPair:r,hasUser:s,getUsers:a,isFullPair:i}}(),Session=function(){var e=function(e,n){$.getJSON("/saveSession?userOne="+e+"&userTwo="+n)};return{saveSession:e}}(),StartPage=function(){var e=function(){$(document).attr("title","Pairmodoro");var e=JST["views/clientside/start.hbs"]();$("#main_display").empty().append(e),Pair.emptyPair(),$.getJSON("/users",function(e){$(e).each(function(e,n){var t=JST["views/clientside/user.hbs"](n);$("#users").append(t),Users.addUser(n)}),$(".loading").hide(),n()})},n=function(){$(".user").click(function(){var e=$(this).find(".avatar"),n=$(this).find(".name").text();Pair.isFullPair()?Pair.hasUser(n)&&(e.toggleClass("selected"),Pair.removeUser(n)):(e.toggleClass("selected"),e.hasClass("selected")?Pair.addUser(n):Pair.removeUser(n))}),$(".chart-icon").click(function(){var e=$(this).parent().find(".name").text();StatsPage.render(e)}),$("#startBtn").click(function(){Notification.askForPermissions(),TimerPage.render()})};return{render:e}}(),StatsPage=function(){var e=function(e){$("#main_display").empty().append(JST["views/clientside/stats.hbs"]({name:e})),t();var i={};$.getJSON("/getSessionsForUser?user="+e,function(t){$.each(t,function(n,t){var s=t.users[0]==e?t.users[1]:t.users[0];i[s]?i[s]+=1:i[s]=1}),console.log(i),$(".loading").hide(),n(e,i)})},n=function(e,n){var t=[];$.each(n,function(e,n){var i=e.length>5?e.substring(0,1)+"dog":e;t.push({y:i,a:n})}),Morris.Bar({element:"statistics",data:t,xkey:"y",ykeys:"a",labels:["Pomodoros finished"],barColors:["rgb(0, 153, 221)"]})},t=function(){$("#backBtn").click(function(){StartPage.render()})};return{render:e}}();this.JST=this.JST||{},this.JST["views/clientside/start.hbs"]=Handlebars.template(function(e,n,t,i,s){return this.compilerInfo=[2,">= 1.0.0-rc.3"],t=t||e.helpers,s=s||{},'        <div class="page-header"><h1>Pick a pair</h1>\n        </div>\n        <i class="loading icon-spinner icon-spin icon-2x"></i>\n        <div class="row-fluid" id="users">\n                </div>\n                <div class="actionbar">\n                <div class="buttons pull-right">\n                <button class="btn btn-large btn-primary btn-success" id="startBtn" type="button" disabled="disabled">Start Pomodoro</button>\n                </div>\n        </div>'}),this.JST["views/clientside/stats.hbs"]=Handlebars.template(function(e,n,t,i,s){this.compilerInfo=[2,">= 1.0.0-rc.3"],t=t||e.helpers,s=s||{};var a,r="",o="function",c=this.escapeExpression;return r+='<div class="page-header"><h1>Stats for ',(a=t.name)?a=a.call(n,{hash:{},data:s}):(a=n.name,a=typeof a===o?a.apply(n):a),r+=c(a)+'</h1>\n        </div>\n        <i class="loading icon-spinner icon-spin icon-2x"></i>\n        <div id="statistics">\n        </div>\n        <div class="actionbar">\n            <div class="buttons pull-left">\n                <button class="btn btn-large btn-primary" id="backBtn" type="button">Back</button>\n            </div>\n        </div>'}),this.JST["views/clientside/timer.hbs"]=Handlebars.template(function(e,n,t,i,s){this.compilerInfo=[2,">= 1.0.0-rc.3"],t=t||e.helpers,s=s||{};var a,r="",o="function",c=this.escapeExpression;return r+='<div class="page-header">\n            <h1 id="timerPageHeader">',(a=t.userOne)?a=a.call(n,{hash:{},data:s}):(a=n.userOne,a=typeof a===o?a.apply(n):a),r+=c(a)+" & ",(a=t.userTwo)?a=a.call(n,{hash:{},data:s}):(a=n.userTwo,a=typeof a===o?a.apply(n):a),r+=c(a)+'</h1>\n        </div>\n        <h1 class="timer"></h1>\n        <h1 id="timerMessage">Well done, now take a break.</h1>\n        <div class="actionbar">\n            <div class="buttons pull-left">\n                <button class="btn btn-large btn-primary" id="changePairBtn" type="button">Change Pair</button>\n            </div>\n            <div class="buttons pull-right">\n                <button class="btn btn-large btn-primary btn-success" id="pomodoroBtn" type="button">Start Pomodoro</button>\n        <button class="btn btn-large btn-primary btn-danger" id="breakBtn" type="button" disabled="disabled">Take a break</button>\n                </div>\n        </div>'}),this.JST["views/clientside/user.hbs"]=Handlebars.template(function(e,n,t,i,s){this.compilerInfo=[2,">= 1.0.0-rc.3"],t=t||e.helpers,s=s||{};var a,r="",o="function",c=this.escapeExpression;return r+='<div class="span3 user">\n            <i class="chart-icon icon-bar-chart"></i>\n            <img src="',(a=t.image)?a=a.call(n,{hash:{},data:s}):(a=n.image,a=typeof a===o?a.apply(n):a),r+=c(a)+'" class="img-circle avatar">\n            <p class="name">',(a=t.name)?a=a.call(n,{hash:{},data:s}):(a=n.name,a=typeof a===o?a.apply(n):a),r+=c(a)+"</p>\n        </div>"});var Timer=function(){function e(e,n){var t=moment(e.asMilliseconds()).format("mm:ss");n&&(t="- "+t),$(".timer").text(t),$(document).attr("title",t)}function n(e){return 0===e.minutes()&&0===e.seconds()}var t,i=function(){$("#timerMessage").css("visibility","hidden"),a()},s=function(){$("#timerMessage").css("visibility","hidden"),$(".timer").removeClass("red"),r()},a=function(){var i=moment.duration(25,"minutes");e(i),t=setInterval(function(){i=moment.duration(i.asSeconds()-1,"seconds"),n(i)&&c(),e(i)},1e3)},r=function(){var i=moment.duration(5,"minutes");e(i),t=setInterval(function(){i=moment.duration(i.asSeconds()-1,"seconds"),n(i)&&d(),e(i)},1e3)},o=function(){$(".timer").addClass("red");var n=moment.duration(0,"seconds");e(n,!0),t=setInterval(function(){n=moment.duration(n.asSeconds()+1,"seconds"),e(n,!0)},1e3)},c=function(){l(),$("#breakBtn").removeAttr("disabled"),$("#timerMessage").css("visibility","visible").hide().fadeIn("slow"),Notification.showPomodoroDone();var e=Pair.getUsers();Session.saveSession(e[0].name,e[1].name)},d=function(){l(),$("#breakBtn").attr("disabled","disabled"),$("#timerMessage").text("Break over, switch driver.").css("visibility","visible").hide().fadeIn("slow"),o(),Notification.showBreakDone()},l=function(){clearTimeout(t)};return{startPomodoro:i,startBreak:s,killTimer:l}}(),TimerPage=function(){var e=function(){var e=Pair.getUsers();$("#main_display").empty().append(JST["views/clientside/timer.hbs"]({userOne:e[0].name,userTwo:e[1].name})),Timer.startPomodoro(),n()},n=function(){$("#pomodoroBtn").click(function(){Timer.killTimer(),Notification.closeNotification(),TimerPage.render()}),$("#breakBtn").click(function(){Timer.killTimer(),Notification.closeNotification(),Timer.startBreak()}),$("#changePairBtn").click(function(){Notification.closeNotification(),Timer.killTimer(),StartPage.render()})};return{render:e}}(),Users=function(){var e=new LacesMap;e.bind("change",function(){});var n=function(n){var t=new LacesModel({name:n.name,image:n.image});e.set(n.name,t)},t=function(n){return e.get(n)};return{addUser:n,getUser:t}}();